#!/bin/sh
#
# Pre-commit hook: Valida sintaxis de archivos Python antes de permitir commit
# Evita commits con errores de sintaxis que rompen Railway
#

echo "๐ Validando sintaxis de archivos Python..."

# Obtener todos los archivos .py que estรกn staged para commit
PYTHON_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.py$')

if [ -z "$PYTHON_FILES" ]; then
    echo "โ No hay archivos Python en este commit"
    exit 0
fi

# Flag para trackear si hubo errores
HAS_ERRORS=0

# Validar cada archivo
for file in $PYTHON_FILES; do
    if [ -f "$file" ]; then
        echo "   Compilando: $file"
        python -m py_compile "$file" 2>&1
        if [ $? -ne 0 ]; then
            echo "โ ERROR DE SINTAXIS en: $file"
            HAS_ERRORS=1
        fi
    fi
done

if [ $HAS_ERRORS -eq 1 ]; then
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "โ COMMIT BLOQUEADO: Hay errores de sintaxis en archivos Python"
    echo "โ Arregla los errores antes de hacer commit"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    exit 1
fi

echo "โ Todos los archivos Python tienen sintaxis vรกlida"
exit 0
